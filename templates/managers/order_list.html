{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <h1 class="text-3xl font-semibold mb-6">All Orders</h1>

  <div class="overflow-x-auto bg-white shadow rounded-lg">
    <table class="min-w-full border-collapse">
      <thead class="bg-gray-50 text-left text-sm font-semibold text-gray-600">
        <tr>
          <th class="p-4">Order</th>
          <th class="p-4">Customer</th>
          <th class="p-4">Total</th>
          <th class="p-4">Status</th>
          <th class="p-4">Update</th>
          <th class="p-4">Prescription</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        {% for o in orders %}
        <tr class="hover:bg-gray-50 transition">
          <td class="p-4 font-medium text-gray-800">#{{ o.id }}</td>

          <td class="p-4 text-gray-700">
            {{ o.user.email }}
          </td>

          <td class="p-4 font-semibold text-gray-800">
            ₹{{ o.total }}
          </td>

          <td class="p-4">
            <span class="px-3 py-1 text-sm rounded-full
              {% if o.status == 'Pending' %} bg-yellow-100 text-yellow-800
              {% elif o.status == 'Packed' %} bg-blue-100 text-blue-800
              {% elif o.status == 'Shipped' %} bg-purple-100 text-purple-800
              {% elif o.status == 'Delivered' %} bg-green-100 text-green-800
              {% endif %}">
              {{ o.status }}
            </span>
          </td>

          <td class="p-4">
            <form method="post" action="{% url 'managers:order-status' o.id %}" class="flex items-center gap-2">
              {% csrf_token %}
              <select
                name="status"
                class="border rounded-md px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="Pending" {% if o.status == "Pending" %}selected{% endif %}>Pending</option>
                <option value="Packed" {% if o.status == "Packed" %}selected{% endif %}>Packed</option>
                <option value="Shipped" {% if o.status == "Shipped" %}selected{% endif %}>Shipped</option>
                <option value="Delivered" {% if o.status == "Delivered" %}selected{% endif %}>Delivered</option>
              </select>

              <button
                type="submit"
                class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
              >
                Save
              </button>
            </form>
          </td>

          <td class="p-4">
            {% if o.prescription %}
              <a
                href="{{ o.prescription.url }}"
                target="_blank"
                class="text-blue-600 hover:text-blue-800 font-medium"
              >
                View
              </a>
            {% else %}
              <span class="text-gray-400">—</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
